From 21bf1de28c7f10bcee1b199cc976d58319dc9ecd Mon Sep 17 00:00:00 2001
From: Peter Hutterer <peter.hutterer@who-t.net>
Date: Fri, 27 Nov 2009 06:01:53 +0000
Subject: dix: fix memory leak, free event list on shutdown. (#25028)

X.Org Bug 25028 <http://bugs.freedesktop.org/show_bug.cgi?id=25028>

Signed-off-by: Peter Hutterer <peter.hutterer@who-t.net>
Reviewed-by: Keith Packard <keithp@keithp.com>
(cherry picked from commit c20c8897272427cb3f755a3e28e80a9ad46f08a1)
---
diff --git a/dix/events.c b/dix/events.c
index 3e23262..1d7ceef 100644
--- a/dix/events.c
+++ b/dix/events.c
@@ -5086,12 +5086,9 @@ InitEvents(void)
 void
 CloseDownEvents(void)
 {
-    int len;
-    EventListPtr list;
-
-    len = GetEventList(&list);
-    while(len--)
-        xfree(list[len].event);
+    FreeEventList(InputEventList, InputEventListLen);
+    InputEventListLen = 0;
+    InputEventList = NULL;
 }
 
 /**
--
cgit v0.8.3-6-g21f6
